     1 00000000                                 [FORMAT "WCOFF"]
     2 00000000                                 [INSTRSET "i486p"]
     3 00000000                                 [OPTIMIZE 1]
     4 00000000                                 [OPTION 1]
     5 00000000                                 [BITS 32]
     6 00000000                                 	EXTERN	_io_load_eflags
     7 00000000                                 	EXTERN	_io_store_eflags
     8 00000000                                 	EXTERN	_memtest_sub
     9 00000000                                 	EXTERN	_load_cr0
    10 00000000                                 	EXTERN	_store_cr0
    11 00000000                                 [FILE "memory.c"]
    12                                          [SECTION .text]
    13 00000000                                 	ALIGN	2
    14 00000000                                 	GLOBAL	_memtest
    15 00000000                                 _memtest:
    16 00000000 55                              	PUSH	EBP
    17 00000001 89 E5                           	MOV	EBP,ESP
    18 00000003 56                              	PUSH	ESI
    19 00000004 53                              	PUSH	EBX
    20 00000005 31 F6                           	XOR	ESI,ESI
    21 00000007 E8 [00000000]                   	CALL	_io_load_eflags
    22 0000000C 0D 00040000                     	OR	EAX,262144
    23 00000011 50                              	PUSH	EAX
    24 00000012 E8 [00000000]                   	CALL	_io_store_eflags
    25 00000017 E8 [00000000]                   	CALL	_io_load_eflags
    26 0000001C 5A                              	POP	EDX
    27 0000001D A9 00040000                     	TEST	EAX,262144
    28 00000022 74 05                           	JE	L2
    29 00000024 BE 00000001                     	MOV	ESI,1
    30 00000029                                 L2:
    31 00000029 25 FFFBFFFF                     	AND	EAX,-262145
    32 0000002E 50                              	PUSH	EAX
    33 0000002F E8 [00000000]                   	CALL	_io_store_eflags
    34 00000034 58                              	POP	EAX
    35 00000035 89 F0                           	MOV	EAX,ESI
    36 00000037 84 C0                           	TEST	AL,AL
    37 00000039 75 31                           	JNE	L5
    38 0000003B                                 L3:
    39 0000003B FF 75 0C                        	PUSH	DWORD [12+EBP]
    40 0000003E FF 75 08                        	PUSH	DWORD [8+EBP]
    41 00000041 E8 [00000000]                   	CALL	_memtest_sub
    42 00000046 5A                              	POP	EDX
    43 00000047 89 C3                           	MOV	EBX,EAX
    44 00000049 59                              	POP	ECX
    45 0000004A 89 F0                           	MOV	EAX,ESI
    46 0000004C 84 C0                           	TEST	AL,AL
    47 0000004E 75 09                           	JNE	L6
    48 00000050                                 L4:
    49 00000050 8D 65 F8                        	LEA	ESP,DWORD [-8+EBP]
    50 00000053 89 D8                           	MOV	EAX,EBX
    51 00000055 5B                              	POP	EBX
    52 00000056 5E                              	POP	ESI
    53 00000057 5D                              	POP	EBP
    54 00000058 C3                              	RET
    55 00000059                                 L6:
    56 00000059 E8 [00000000]                   	CALL	_load_cr0
    57 0000005E 25 9FFFFFFF                     	AND	EAX,-1610612737
    58 00000063 50                              	PUSH	EAX
    59 00000064 E8 [00000000]                   	CALL	_store_cr0
    60 00000069 58                              	POP	EAX
    61 0000006A EB E4                           	JMP	L4
    62 0000006C                                 L5:
    63 0000006C E8 [00000000]                   	CALL	_load_cr0
    64 00000071 0D 60000000                     	OR	EAX,1610612736
    65 00000076 50                              	PUSH	EAX
    66 00000077 E8 [00000000]                   	CALL	_store_cr0
    67 0000007C 5B                              	POP	EBX
    68 0000007D EB BC                           	JMP	L3
    69 0000007F 90                              	ALIGN	2
    70 00000080                                 	GLOBAL	_memman_init
    71 00000080                                 _memman_init:
    72 00000080 55                              	PUSH	EBP
    73 00000081 89 E5                           	MOV	EBP,ESP
    74 00000083 8B 45 08                        	MOV	EAX,DWORD [8+EBP]
    75 00000086 C7 00 00000000                  	MOV	DWORD [EAX],0
    76 0000008C C7 40 04 00000000               	MOV	DWORD [4+EAX],0
    77 00000093 C7 40 08 00000000               	MOV	DWORD [8+EAX],0
    78 0000009A C7 40 0C 00000000               	MOV	DWORD [12+EAX],0
    79 000000A1 5D                              	POP	EBP
    80 000000A2 C3                              	RET
    81 000000A3 90                              	ALIGN	2
    82 000000A4                                 	GLOBAL	_memman_total
    83 000000A4                                 _memman_total:
    84 000000A4 55                              	PUSH	EBP
    85 000000A5 31 C0                           	XOR	EAX,EAX
    86 000000A7 89 E5                           	MOV	EBP,ESP
    87 000000A9 31 D2                           	XOR	EDX,EDX
    88 000000AB 53                              	PUSH	EBX
    89 000000AC 8B 5D 08                        	MOV	EBX,DWORD [8+EBP]
    90 000000AF 8B 0B                           	MOV	ECX,DWORD [EBX]
    91 000000B1 39 C8                           	CMP	EAX,ECX
    92 000000B3 73 09                           	JAE	L15
    93 000000B5                                 L13:
    94 000000B5 03 44 D3 14                     	ADD	EAX,DWORD [20+EBX+EDX*8]
    95 000000B9 42                              	INC	EDX
    96 000000BA 39 CA                           	CMP	EDX,ECX
    97 000000BC 72 F7                           	JB	L13
    98 000000BE                                 L15:
    99 000000BE 5B                              	POP	EBX
   100 000000BF 5D                              	POP	EBP
   101 000000C0 C3                              	RET
   102 000000C1 90                              	ALIGN	2
   103 000000C2                                 	GLOBAL	_memman_alloc
   104 000000C2                                 _memman_alloc:
   105 000000C2 55                              	PUSH	EBP
   106 000000C3 31 C9                           	XOR	ECX,ECX
   107 000000C5 89 E5                           	MOV	EBP,ESP
   108 000000C7 57                              	PUSH	EDI
   109 000000C8 56                              	PUSH	ESI
   110 000000C9 53                              	PUSH	EBX
   111 000000CA 8B 75 0C                        	MOV	ESI,DWORD [12+EBP]
   112 000000CD 8B 5D 08                        	MOV	EBX,DWORD [8+EBP]
   113 000000D0 8B 03                           	MOV	EAX,DWORD [EBX]
   114 000000D2 39 C1                           	CMP	ECX,EAX
   115 000000D4 73 0D                           	JAE	L30
   116 000000D6                                 L28:
   117 000000D6 8B 54 CB 14                     	MOV	EDX,DWORD [20+EBX+ECX*8]
   118 000000DA 39 F2                           	CMP	EDX,ESI
   119 000000DC 73 0C                           	JAE	L32
   120 000000DE 41                              	INC	ECX
   121 000000DF 39 C1                           	CMP	ECX,EAX
   122 000000E1 72 F3                           	JB	L28
   123 000000E3                                 L30:
   124 000000E3 31 C0                           	XOR	EAX,EAX
   125 000000E5                                 L16:
   126 000000E5 5B                              	POP	EBX
   127 000000E6 5E                              	POP	ESI
   128 000000E7 5F                              	POP	EDI
   129 000000E8 5D                              	POP	EBP
   130 000000E9 C3                              	RET
   131 000000EA                                 L32:
   132 000000EA 8B 7C CB 10                     	MOV	EDI,DWORD [16+EBX+ECX*8]
   133 000000EE 8D 04 3E                        	LEA	EAX,DWORD [ESI+EDI*1]
   134 000000F1 89 44 CB 10                     	MOV	DWORD [16+EBX+ECX*8],EAX
   135 000000F5 89 D0                           	MOV	EAX,EDX
   136 000000F7 29 F0                           	SUB	EAX,ESI
   137 000000F9 89 44 CB 14                     	MOV	DWORD [20+EBX+ECX*8],EAX
   138 000000FD 85 C0                           	TEST	EAX,EAX
   139 000000FF 75 20                           	JNE	L22
   140 00000101 8B 03                           	MOV	EAX,DWORD [EBX]
   141 00000103 48                              	DEC	EAX
   142 00000104 89 03                           	MOV	DWORD [EBX],EAX
   143 00000106 39 C1                           	CMP	ECX,EAX
   144 00000108 73 17                           	JAE	L22
   145 0000010A 89 C6                           	MOV	ESI,EAX
   146 0000010C                                 L27:
   147 0000010C 8B 44 CB 18                     	MOV	EAX,DWORD [24+EBX+ECX*8]
   148 00000110 8B 54 CB 1C                     	MOV	EDX,DWORD [28+EBX+ECX*8]
   149 00000114 89 44 CB 10                     	MOV	DWORD [16+EBX+ECX*8],EAX
   150 00000118 89 54 CB 14                     	MOV	DWORD [20+EBX+ECX*8],EDX
   151 0000011C 41                              	INC	ECX
   152 0000011D 39 F1                           	CMP	ECX,ESI
   153 0000011F 72 EB                           	JB	L27
   154 00000121                                 L22:
   155 00000121 89 F8                           	MOV	EAX,EDI
   156 00000123 EB C0                           	JMP	L16
   157 00000125 90                              	ALIGN	2
   158 00000126                                 	GLOBAL	_memman_free
   159 00000126                                 _memman_free:
   160 00000126 55                              	PUSH	EBP
   161 00000127 89 E5                           	MOV	EBP,ESP
   162 00000129 57                              	PUSH	EDI
   163 0000012A 56                              	PUSH	ESI
   164 0000012B 8B 75 08                        	MOV	ESI,DWORD [8+EBP]
   165 0000012E 53                              	PUSH	EBX
   166 0000012F 31 DB                           	XOR	EBX,EBX
   167 00000131 8B 3E                           	MOV	EDI,DWORD [ESI]
   168 00000133 39 FB                           	CMP	EBX,EDI
   169 00000135 7D 0E                           	JGE	L35
   170 00000137                                 L39:
   171 00000137 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   172 0000013A 39 44 DE 10                     	CMP	DWORD [16+ESI+EBX*8],EAX
   173 0000013E 77 05                           	JA	L35
   174 00000140 43                              	INC	EBX
   175 00000141 39 FB                           	CMP	EBX,EDI
   176 00000143 7C F2                           	JL	L39
   177 00000145                                 L35:
   178 00000145 85 DB                           	TEST	EBX,EBX
   179 00000147 7E 0F                           	JLE	L40
   180 00000149 8B 54 DE 0C                     	MOV	EDX,DWORD [12+ESI+EBX*8]
   181 0000014D 8B 44 DE 08                     	MOV	EAX,DWORD [8+ESI+EBX*8]
   182 00000151 01 D0                           	ADD	EAX,EDX
   183 00000153 3B 45 0C                        	CMP	EAX,DWORD [12+EBP]
   184 00000156 74 73                           	JE	L63
   185 00000158                                 L40:
   186 00000158 39 FB                           	CMP	EBX,EDI
   187 0000015A 7D 0C                           	JGE	L49
   188 0000015C 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   189 0000015F 03 45 10                        	ADD	EAX,DWORD [16+EBP]
   190 00000162 3B 44 DE 10                     	CMP	EAX,DWORD [16+ESI+EBX*8]
   191 00000166 74 53                           	JE	L64
   192 00000168                                 L49:
   193 00000168 81 FF 00000FF9                  	CMP	EDI,4089
   194 0000016E 7F 3D                           	JG	L51
   195 00000170 89 F9                           	MOV	ECX,EDI
   196 00000172 39 DF                           	CMP	EDI,EBX
   197 00000174 7E 15                           	JLE	L61
   198 00000176                                 L56:
   199 00000176 8B 44 CE 08                     	MOV	EAX,DWORD [8+ESI+ECX*8]
   200 0000017A 8B 54 CE 0C                     	MOV	EDX,DWORD [12+ESI+ECX*8]
   201 0000017E 89 44 CE 10                     	MOV	DWORD [16+ESI+ECX*8],EAX
   202 00000182 89 54 CE 14                     	MOV	DWORD [20+ESI+ECX*8],EDX
   203 00000186 49                              	DEC	ECX
   204 00000187 39 D9                           	CMP	ECX,EBX
   205 00000189 7F EB                           	JG	L56
   206 0000018B                                 L61:
   207 0000018B 8D 47 01                        	LEA	EAX,DWORD [1+EDI]
   208 0000018E 89 06                           	MOV	DWORD [ESI],EAX
   209 00000190 39 46 04                        	CMP	DWORD [4+ESI],EAX
   210 00000193 7D 03                           	JGE	L57
   211 00000195 89 46 04                        	MOV	DWORD [4+ESI],EAX
   212 00000198                                 L57:
   213 00000198 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   214 0000019B 89 44 DE 10                     	MOV	DWORD [16+ESI+EBX*8],EAX
   215 0000019F 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   216 000001A2 89 44 DE 14                     	MOV	DWORD [20+ESI+EBX*8],EAX
   217 000001A6                                 L62:
   218 000001A6 31 C0                           	XOR	EAX,EAX
   219 000001A8                                 L33:
   220 000001A8 5B                              	POP	EBX
   221 000001A9 5E                              	POP	ESI
   222 000001AA 5F                              	POP	EDI
   223 000001AB 5D                              	POP	EBP
   224 000001AC C3                              	RET
   225 000001AD                                 L51:
   226 000001AD 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   227 000001B0 FF 46 0C                        	INC	DWORD [12+ESI]
   228 000001B3 01 46 08                        	ADD	DWORD [8+ESI],EAX
   229 000001B6 83 C8 FF                        	OR	EAX,-1
   230 000001B9 EB ED                           	JMP	L33
   231 000001BB                                 L64:
   232 000001BB 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   233 000001BE 89 44 DE 10                     	MOV	DWORD [16+ESI+EBX*8],EAX
   234 000001C2 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   235 000001C5 01 44 DE 14                     	ADD	DWORD [20+ESI+EBX*8],EAX
   236 000001C9 EB DB                           	JMP	L62
   237 000001CB                                 L63:
   238 000001CB 03 55 10                        	ADD	EDX,DWORD [16+EBP]
   239 000001CE 89 54 DE 0C                     	MOV	DWORD [12+ESI+EBX*8],EDX
   240 000001D2 3B 1E                           	CMP	EBX,DWORD [ESI]
   241 000001D4 7D D0                           	JGE	L62
   242 000001D6 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   243 000001D9 03 45 10                        	ADD	EAX,DWORD [16+EBP]
   244 000001DC 3B 44 DE 10                     	CMP	EAX,DWORD [16+ESI+EBX*8]
   245 000001E0 75 C4                           	JNE	L62
   246 000001E2 03 54 DE 14                     	ADD	EDX,DWORD [20+ESI+EBX*8]
   247 000001E6 89 54 DE 0C                     	MOV	DWORD [12+ESI+EBX*8],EDX
   248 000001EA 8B 06                           	MOV	EAX,DWORD [ESI]
   249 000001EC 48                              	DEC	EAX
   250 000001ED 89 06                           	MOV	DWORD [ESI],EAX
   251 000001EF 39 C3                           	CMP	EBX,EAX
   252 000001F1 7D B3                           	JGE	L62
   253 000001F3 89 C1                           	MOV	ECX,EAX
   254 000001F5                                 L48:
   255 000001F5 8B 44 DE 18                     	MOV	EAX,DWORD [24+ESI+EBX*8]
   256 000001F9 8B 54 DE 1C                     	MOV	EDX,DWORD [28+ESI+EBX*8]
   257 000001FD 89 44 DE 10                     	MOV	DWORD [16+ESI+EBX*8],EAX
   258 00000201 89 54 DE 14                     	MOV	DWORD [20+ESI+EBX*8],EDX
   259 00000205 43                              	INC	EBX
   260 00000206 39 CB                           	CMP	EBX,ECX
   261 00000208 7C EB                           	JL	L48
   262 0000020A EB 9A                           	JMP	L62
   263 0000020C                                 	ALIGN	2
   264 0000020C                                 	GLOBAL	_memman_alloc_4k
   265 0000020C                                 _memman_alloc_4k:
   266 0000020C 55                              	PUSH	EBP
   267 0000020D 89 E5                           	MOV	EBP,ESP
   268 0000020F 8B 45 0C                        	MOV	EAX,DWORD [12+EBP]
   269 00000212 05 00000FFF                     	ADD	EAX,4095
   270 00000217 25 FFFFF000                     	AND	EAX,-4096
   271 0000021C 89 45 0C                        	MOV	DWORD [12+EBP],EAX
   272 0000021F 5D                              	POP	EBP
   273 00000220 E9 FFFFFE9D                     	JMP	_memman_alloc
   274 00000225 90                              	ALIGN	2
   275 00000226                                 	GLOBAL	_memman_free_4k
   276 00000226                                 _memman_free_4k:
   277 00000226 55                              	PUSH	EBP
   278 00000227 89 E5                           	MOV	EBP,ESP
   279 00000229 8B 45 10                        	MOV	EAX,DWORD [16+EBP]
   280 0000022C 05 00000FFF                     	ADD	EAX,4095
   281 00000231 25 FFFFF000                     	AND	EAX,-4096
   282 00000236 89 45 10                        	MOV	DWORD [16+EBP],EAX
   283 00000239 5D                              	POP	EBP
   284 0000023A E9 FFFFFEE7                     	JMP	_memman_free
